<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quick Collector â€” Tally + Server</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root{
      --card-bg:rgba(255,255,255,0.95);
      --muted:#64748b;
      --accent:#06b6d4;
      --text:#04202a;
      --glass: rgba(255,255,255,0.6);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      display:flex;align-items:center;justify-content:center;padding:24px;
      background:
        linear-gradient(180deg, rgba(7,10,25,0.14), rgba(7,10,25,0.14)),
        url('https://images.unsplash.com/photo-1503264116251-35a269479413?auto=format&fit=crop&w=2100&q=80') no-repeat center/cover fixed;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color:var(--text);
    }
    .wrap{width:100%;max-width:760px}
    .card{background:var(--card-bg);backdrop-filter:blur(6px);border-radius:14px;padding:22px;box-shadow:0 16px 50px rgba(2,6,23,0.12)}
    h1{margin:0 0 8px;font-size:1.35rem}
    p{margin:0 0 12px;color:var(--muted)}
    .row{display:flex;gap:12px}
    button{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn-primary{background:var(--accent);color:white}
    .btn-ghost{background:transparent;border:1px solid rgba(2,6,23,0.06);color:#062023}
    input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);margin-top:8px;font-size:1rem}
    .hidden{display:none}
    .note{font-size:0.95rem;color:var(--muted);margin-top:10px}
    .center{text-align:center}
    .small{font-size:0.85rem;color:var(--muted);margin-top:12px;text-align:center}
    @media (max-width:520px){
      .row{flex-direction:column}
      .card{padding:18px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <main class="card" id="viewChoose">
      <h1>Quick check</h1>
      <p class="note">Pick how you identify to continue.</p>
      <div class="row" style="margin-top:12px">
        <button id="girlBtn" class="btn-primary" style="flex:1">Girl</button>
        <button id="boyBtn" class="btn-ghost" style="flex:1">Boy</button>
      </div>
      <p class="small">bonus: ek baar ek raja hota hai... â€” ye joke kitna funny hai?</p>
    </main>

    <section class="card hidden" id="viewName">
      <h1>Your name?</h1>
      <input id="inputName" placeholder="Type your name" autocomplete="name" />
      <div class="row" style="margin-top:12px">
        <button id="nameNext" class="btn-primary">Next</button>
        <button id="nameBack" class="btn-ghost">Back</button>
      </div>
    </section>

    <section class="card hidden" id="viewID">
      <h1>Social ID</h1>
      <p class="note">Insta or Snap (without @)</p>
      <input id="inputID" placeholder="your_insta_or_snap" autocomplete="username" />
      <div class="row" style="margin-top:12px">
        <button id="submitAll" class="btn-primary">Submit</button>
        <button id="idBack" class="btn-ghost">Back</button>
      </div>
    </section>

    <section class="card hidden" id="goodbyePage">
      <h1>All set ðŸ’«</h1>
      <p class="note">We saved a copy to your server. Please finish the Tally form in the new tab to store it in Tally as well.</p>
      <p class="center" style="margin-top:14px;">
        <a class="btn-ghost" href="https://wa.me/919694987181" target="_blank" rel="noopener noreferrer">Contact</a>
      </p>
      <div class="center" style="margin-top:12px">
        <button id="restartFromGoodbye" class="btn-ghost">Back to start</button>
      </div>
    </section>
  </div>

  <script>
    /**********************
     CONFIG - EDIT THESE
    **********************/
    // Tally share link (you already gave this)
    const TALLY_SHARE = "https://tally.so/r/dWWkAr";

    // IMPORTANT: change this to your server endpoint that accepts JSON POSTs
    // Example: https://api.yoursite.com/api/collect
    const SERVER_ENDPOINT = "https://your-domain.com/api/collect";
    /**********************/

    // UI elements
    const viewChoose = document.getElementById("viewChoose");
    const viewName = document.getElementById("viewName");
    const viewID = document.getElementById("viewID");
    const goodbyePage = document.getElementById("goodbyePage");

    const girlBtn = document.getElementById("girlBtn");
    const boyBtn = document.getElementById("boyBtn");
    const nameNext = document.getElementById("nameNext");
    const nameBack = document.getElementById("nameBack");
    const idBack = document.getElementById("idBack");
    const submitAll = document.getElementById("submitAll");

    const restartFromGoodbye = document.getElementById("restartFromGoodbye");

    const inputName = document.getElementById("inputName");
    const inputID = document.getElementById("inputID");

    let currentGender = null;

    // Helpers
    function show(el){ el.classList.remove("hidden"); el.scrollIntoView({behavior:'smooth',block:'center'}); }
    function hide(el){ el.classList.add("hidden"); }
    function hideAll(){ hide(viewChoose); hide(viewName); hide(viewID); hide(goodbyePage); }

    // Start
    girlBtn.addEventListener("click", ()=>{ currentGender = "Girl"; hideAll(); show(viewName); });
    boyBtn.addEventListener("click", ()=>{ currentGender = "Boy"; hideAll(); show(viewName); });

    nameBack.addEventListener("click", ()=>{ hideAll(); show(viewChoose); });
    idBack.addEventListener("click", ()=>{ hideAll(); show(viewName); });

    nameNext.addEventListener("click", ()=>{
      const val = inputName.value.trim();
      sessionStorage.setItem("qc_name", val);
      hideAll(); show(viewID);
    });

    // Primary submit flow:
    // 1) send JSON to your server endpoint (guarantees server gets data)
    // 2) open Tally pre-filled link in new tab so user can finish & submit to Tally
    submitAll.addEventListener("click", async ()=> {
      const name = sessionStorage.getItem("qc_name") || "";
      const id = inputID.value.trim();
      const gender = currentGender || "";
      const timestamp = new Date().toISOString();

      const payload = { name, id, gender, time: timestamp, source: "web-quick-collector" };

      // Basic validation
      if(!name && !id){
        alert("Please enter at least a name or ID.");
        return;
      }

      // 1) POST to your server
      try {
        // Note: change credentials / headers if you need auth
        const p = await fetch(SERVER_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });
        // if server returns non-OK, still continue UX but log
        if(!p.ok) console.warn("Server returned non-OK:", p.status);
      } catch (err) {
        console.warn("Failed to reach server endpoint:", err);
      }

      // 2) open Tally prefill
      // IMPORTANT: In your Tally editor you must add Hidden fields named exactly: name, id, gender
      const params = new URLSearchParams({ name, id, gender }).toString();
      const prefill = TALLY_SHARE + "?" + params;

      // open in new tab for user to confirm/submit
      window.open(prefill, "_blank", "noopener");

      // 3) show final UI in parent
      hideAll();
      show(goodbyePage);
      // optionally clear stored name so next user starts fresh
      sessionStorage.removeItem("qc_name");
    });

    // restart
    restartFromGoodbye.addEventListener("click", ()=>{
      hideAll();
      show(viewChoose);
    });

    // prefill name from sessionStorage
    document.addEventListener("DOMContentLoaded", ()=>{
      const prev = sessionStorage.getItem("qc_name");
      if(prev) inputName.value = prev;
    });

    // Helpful dev-mode log (remove in production if you want)
    console.info("Quick Collector loaded. Remember to set SERVER_ENDPOINT to your real URL.");
  </script>
</body>
</html>
