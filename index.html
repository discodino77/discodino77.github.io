<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quick Collector â€” Rewired</title>
  <style>
    :root{--card-bg:rgba(255,255,255,0.88);--muted:#64748b;--accent:#06b6d4}
    *{box-sizing:border-box}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:32px;
      background:
        linear-gradient(180deg, rgba(7,10,25,0.18), rgba(7,10,25,0.18)),
        url('https://images.unsplash.com/photo-1503264116251-35a269479413?auto=format&fit=crop&w=2100&q=80') no-repeat center/cover fixed;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }
    .card{width:100%;max-width:720px;background:var(--card-bg);backdrop-filter:blur(6px);border-radius:14px;padding:22px;box-shadow:0 12px 40px rgba(2,6,23,0.18);color:#04202a}
    h1{margin:0 0 6px;font-size:1.25rem}
    p{margin:0 0 14px;color:var(--muted)}
    .row{display:flex;gap:12px}
    button{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn-primary{background:var(--accent);color:white}
    .btn-ghost{background:transparent;border:1px solid rgba(2,6,23,0.06);color:#062023}
    input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);margin-top:8px}
    .hidden{display:none}
    textarea{width:100%;height:140px;padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);margin-top:10px}
    .note{font-size:0.95rem;color:var(--muted);margin-top:10px}
    .center{display:flex;justify-content:center}
    footer.small{font-size:0.85rem;color:var(--muted);margin-top:10px;text-align:center}
  </style>
</head>
<body>
  <!-- choose -->
  <main class="card" id="viewChoose">
    <h1>Quick check</h1>
    <p>Pick how you identify to continue.</p>

    <div class="row" style="margin-bottom:12px">
      <button id="girlBtn" class="btn-primary" style="flex:1">Girl</button>
      <button id="boyBtn" class="btn-ghost" style="flex:1">Boy</button>
    </div>

    <p class="note small">bonus joke: ek baar ek raja fakeer ko bolta hai ae gareebðŸ˜­ðŸ˜­ðŸ˜­ðŸ˜­ðŸ˜­ðŸ˜‚ðŸ˜‚ðŸ˜‚ðŸ˜‚ðŸ˜‚ðŸ˜‚
      kitna funny joke hai yawwr ye ðŸ˜­ðŸ˜­ðŸ˜‚ðŸ˜‚ðŸ˜‚ðŸ˜‚ðŸ˜‚
    </p>

    <div style="margin-top:18px">
      <label class="note">Owner actions</label>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="openAdmin" class="btn-ghost">Open admin</button>
      </div>
    </div>
    <footer class="small">Tip: Admin requires a password.</footer>
  </main>

  <!-- name -->
  <section class="card hidden" id="viewName">
    <h1>Tell me your name</h1>
    <p class="note">This helps the owner know who submitted.</p>
    <input id="inputName" placeholder="Type your name" autocomplete="off" />
    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="nameNext" class="btn-primary">Next</button>
      <button id="nameBack" class="btn-ghost">Back</button>
    </div>
  </section>

  <!-- id -->
  <section class="card hidden" id="viewID">
    <h1>Social ID</h1>
    <p class="note">Add Insta or Snap username (no @ needed).</p>
    <input id="inputID" placeholder="your_insta_or_snap" autocomplete="off" />
    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="submitAll" class="btn-primary">Submit</button>
      <button id="idBack" class="btn-ghost">Back</button>
    </div>
  </section>

  <!-- goodbye for girls -->
  <section class="card hidden" id="goodbyePage">
    <h1>Goodbye sweetie ðŸ’•</h1>
    <p class="note">Your data has been submitted. Thanks!</p>
  </section>

  <!-- done for boys -->
  <section class="card hidden" id="boyDone">
    <h1>You're king ðŸ‘‘</h1>
    <p class="note">Always follow your passion!</p>
  </section>

  <!-- admin (password protected) -->
  <section class="card hidden" id="adminPanel">
    <h1>Admin panel</h1>
    <p class="note">View, download, or copy submissions.</p>

    <div style="display:flex;gap:8px;margin-top:10px">
      <button id="viewEntries" class="btn-primary">Show entries</button>
      <button id="downloadCSV" class="btn-ghost">Download CSV</button>
      <button id="copyClip" class="btn-ghost">Copy to clipboard</button>
    </div>

    <div style="margin-top:12px">
      <textarea id="entriesArea" readonly placeholder="Entries will appear here"></textarea>
    </div>

    <div id="adminClearWrap" style="display:flex;gap:8px;margin-top:10px">
      <button id="clearAllAdmin" class="btn-ghost">Clear all data</button>
    </div>

    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="closeAdmin" class="btn-ghost">Close</button>
    </div>
  </section>

  <script>
    // elements
    const viewChoose = document.getElementById('viewChoose');
    const viewName = document.getElementById('viewName');
    const viewID = document.getElementById('viewID');
    const goodbyePage = document.getElementById('goodbyePage');
    const boyDone = document.getElementById('boyDone');
    const adminPanel = document.getElementById('adminPanel');

    const girlBtn = document.getElementById('girlBtn');
    const boyBtn = document.getElementById('boyBtn');
    const nameNext = document.getElementById('nameNext');
    const nameBack = document.getElementById('nameBack');
    const idBack = document.getElementById('idBack');
    const submitAll = document.getElementById('submitAll');
    const inputName = document.getElementById('inputName');
    const inputID = document.getElementById('inputID');

    const openAdmin = document.getElementById('openAdmin');
    const adminEntries = document.getElementById('viewEntries');
    const entriesArea = document.getElementById('entriesArea');
    const downloadCSV = document.getElementById('downloadCSV');
    const copyClip = document.getElementById('copyClip');
    const closeAdmin = document.getElementById('closeAdmin');
    const clearAllAdmin = document.getElementById('clearAllAdmin');

    // state
    let currentGender = null;

    // helpers
    const KEY = 'quick_collector_entries_v1';
    function show(el){ el.classList.remove('hidden'); }
    function hide(el){ el.classList.add('hidden'); }

    function saveSubmission(entry){
      const raw = localStorage.getItem(KEY);
      const arr = raw ? JSON.parse(raw) : [];
      arr.push(entry);
      localStorage.setItem(KEY, JSON.stringify(arr));
    }
    function getEntries(){ const raw = localStorage.getItem(KEY); return raw ? JSON.parse(raw) : []; }

    function entriesToText(arr){
      if(!arr.length) return 'No entries yet.';
      return arr.map(a => `[${a.t}] ${a.gender} | name: ${a.name || '-'} | id: ${a.id || '-'}`).join('\n');
    }
    function entriesToCSV(arr){
      const header = ['timestamp','gender','name','id'];
      const rows = arr.map(a => [a.t, a.gender, `"${(a.name||'').replace(/"/g,'""')}"`, `"${(a.id||'').replace(/"/g,'""')}"`]);
      return [header.join(','), ...rows.map(r=>r.join(','))].join('\n');
    }

    // debug test listeners so clicks are visible in console
    ['girlBtn','boyBtn','nameNext','nameBack','submitAll','idBack','openAdmin','viewEntries','downloadCSV','copyClip','closeAdmin','clearAllAdmin'].forEach(id=>{
      const el = document.getElementById(id);
      if(el) el.addEventListener('click', ()=>console.log('TEST CLICK:', id));
    });

    // wiring
    girlBtn.addEventListener('click', ()=>{
      currentGender = 'Girl';
      inputName.value = '';
      inputID.value = '';
      hideAllScreens();
      show(viewName);
      inputName.focus();
    });

    boyBtn.addEventListener('click', ()=>{
      currentGender = 'Boy';
      inputName.value = '';
      inputID.value = '';
      hideAllScreens();
      show(viewName);
      inputName.focus();
    });

    nameBack.addEventListener('click', ()=>{
      hideAllScreens();
      show(viewChoose);
    });

    idBack.addEventListener('click', ()=>{
      hideAllScreens();
      show(viewName);
    });

    nameNext.addEventListener('click', ()=>{
      // proceed to ID screen
      const name = inputName.value.trim();
      sessionStorage.setItem('qc_name', name);
      hideAllScreens();
      show(viewID);
      inputID.focus();
    });

    submitAll.addEventListener('click', ()=>{
      const id = inputID.value.trim();
      const name = sessionStorage.getItem('qc_name') || '';
      const entry = { t: new Date().toLocaleString(), gender: currentGender, name, id };
      saveSubmission(entry);
      // clear session storage
      sessionStorage.removeItem('qc_name');
      inputID.value = '';
      inputName.value = '';
      // show final page depending on gender
      hideAllScreens();
      if(currentGender === 'Girl'){
        show(goodbyePage); // stops here
      } else {
        show(boyDone); // stops here
      }
    });

    // admin (password-protected)
    openAdmin.addEventListener('click', ()=>{
      const pass = prompt('Enter admin password:');
      if(pass !== 'PKpk55@?'){
        alert('Wrong password');
        return;
      }
      hideAllScreens();
      show(adminPanel);
      entriesArea.value = entriesToText(getEntries());
    });

    closeAdmin.addEventListener('click', ()=>{
      hideAllScreens();
      show(viewChoose);
    });

    adminEntries.addEventListener('click', ()=>{
      entriesArea.value = entriesToText(getEntries());
    });

    downloadCSV.addEventListener('click', ()=>{
      const arr = getEntries();
      const csv = entriesToCSV(arr);
      const blob = new Blob([csv], {type: 'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'entries.csv';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    copyClip.addEventListener('click', async ()=>{
      const txt = entriesToText(getEntries());
      try{
        await navigator.clipboard.writeText(txt);
        alert('Copied to clipboard');
      }catch(e){
        alert('Unable to copy (browser blocked) â€” use Show entries then copy manually.');
      }
    });

    clearAllAdmin.addEventListener('click', ()=>{
      if(!confirm('Clear all saved entries? This cannot be undone.')) return;
      localStorage.removeItem(KEY);
      entriesArea.value = 'No entries yet.';
      alert('Cleared.');
    });

    // utils
    function hideAllScreens(){
      hide(viewChoose); hide(viewName); hide(viewID); hide(goodbyePage); hide(boyDone); hide(adminPanel);
    }

    // init
    hideAllScreens();
    show(viewChoose);
  </script>
</body>
</html>
